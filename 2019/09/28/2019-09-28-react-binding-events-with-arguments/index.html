<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Reactäº‹ä»¶ç»‘å®šç»ˆæä¼˜åŒ–æ–¹æ¡ˆ Â· å°å®‹</title><meta name="description" content="Reactäº‹ä»¶ç»‘å®šç»ˆæä¼˜åŒ–æ–¹æ¡ˆ - rwson"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="å°å®‹"><link rel="alternate" href="/atom.xml" title="å°å®‹" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Reactäº‹ä»¶ç»‘å®šç»ˆæä¼˜åŒ–æ–¹æ¡ˆ</h1><div class="post-info">Sep 28, 2019</div><div class="post-content"><p><code>React</code>ä½œä¸ºç›®å‰ç‚™æ‰‹å¯çƒ­çš„å‰ç«¯æ¡†æ¶ï¼Œé‡Œé¢æœ‰å¾ˆå¤šå¸å¼•äººçš„åœ°æ–¹ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å¼€å‘ä½“éªŒä¸å¤ªå¥½çš„åœ°æ–¹ï¼Œæ¯”å¦‚æˆ‘ä»¬å¹³æ—¶åšäº‹ä»¶ç»‘å®šçš„æ—¶å€™è¦æ˜¾ç¤ºçš„ç»‘å®š<code>this</code>ï¼Œå¦åˆ™å°±å¯èƒ½å¯¼è‡´å„ç§<code>bug</code>ï¼Œå…³äºäº‹ä»¶<code>this</code>ç»‘å®šä¹Ÿæœ‰å¾ˆå¤šç§å½¢å¼ï¼Œå„ç§æ–¹æ³•éƒ½æœ‰ä¼˜åŠ£ï¼Œä¸‹é¢æˆ‘ä»¬å°†å¯¹ç…§å‡ ç§ç»‘å®šæ–¹å¼æ¥è¿›è¡Œå¯¹æ¯”ï¼Œæœ€ç»ˆå®ç°ä¸€ä¸ªé€‚åˆè‡ªå·±çš„æ–¹æ¡ˆ</p>
<h5 id="åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œç»‘å®š"><a href="#åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œç»‘å®š" class="headerlink" title="åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œç»‘å®š"></a>åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œç»‘å®š</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      t: <span class="string">'t'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// this.bind1 = this.bind1.bind(this) æ— å‚å†™æ³•</span></span><br><span class="line">    <span class="keyword">this</span>.bind1 = <span class="keyword">this</span>.bind1.bind(<span class="keyword">this</span>, <span class="keyword">this</span>.state.t)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ— å‚å†™æ³• </span></span><br><span class="line">    <span class="comment">// bind1 () &#123;</span></span><br><span class="line">    <span class="comment">//   console.log('bind1', this)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  bind1 (t, event) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'bind1'</span>, <span class="keyword">this</span>, t, event)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.bind1&#125;&gt;æ‰“å°<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹å°±æ˜¯åªä¼šç”Ÿæˆä¸€ä¸ªæ–¹æ³•å®ä¾‹ï¼Œå¹¶ä¸”ç»‘å®šä¸€æ¬¡ä¹‹åå¦‚æœå¤šæ¬¡ç”¨åˆ°è¿™ä¸ªæ–¹æ³•ä¹Ÿä¸éœ€è¦å†ç»‘å®šã€‚ç¼ºç‚¹æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨<code>constructor</code>ä¸­è¿›è¡Œç»‘å®šçš„è¯ï¼Œå‚æ•°å°±æ— æ³•åŠ¨æ€åŒ–ï¼Œåªèƒ½å›ºå®šæ­»ç”¨<code>state</code>é‡Œçš„å€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸€ä¸ªåˆ—è¡¨ç»„ä»¶ï¼Œ  ç‚¹å‡»æŸä¸€æ¡æŸä¸€ä¸ªå…·ä½“æ“ä½œçš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ª<code>id</code>ä¹‹ç±»çš„å­—æ®µä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œè¿™ç§ç»‘å®šå½¢å¼å°±æ— æ³•å¤„ç†äº†ï¼Œç¼ºç‚¹äºŒå°±æ˜¯å³ä½¿ä¸ç”¨åˆ°<code>state</code>ï¼Œä¹Ÿéœ€è¦åœ¨æ„é€ å™¨é‡Œåšç»‘å®š</p>
<h5 id="è¡Œå†…åŒ¿åå‡½æ•°"><a href="#è¡Œå†…åŒ¿åå‡½æ•°" class="headerlink" title="è¡Œå†…åŒ¿åå‡½æ•°"></a>è¡Œå†…åŒ¿åå‡½æ•°</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bind3 (t, event) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'bind3'</span>, <span class="keyword">this</span>, t, event)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render () &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      <span class="comment">// &lt;button onClick=&#123;() =&gt; this.bind3()&#125;&gt;æ‰“å°3&lt;/button&gt; æ— å‚å†™æ³•</span></span><br><span class="line">      &lt;button onClick=&#123;(event) =&gt; <span class="keyword">this</span>.bind3(<span class="keyword">this</span>.state.t, event)&#125;&gt;æ‰“å°<span class="number">3</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹å°±æ˜¯æ¯”è¾ƒç®€å•ï¼Œçµæ´»ï¼Œä½†æ˜¯æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯åœ¨æ¯æ¬¡<code>render</code>çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œå½“è¿™ä¸ªå‡½æ•°ä½œä¸º<code>props</code>ä¼ å…¥ä½é˜¶ç»„ä»¶çš„æ—¶å€™ï¼Œè¿™äº›ç»„ä»¶å¯èƒ½ä¼šè¿›è¡Œé¢å¤–çš„é‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºæ¯ä¸€æ¬¡éƒ½æ˜¯æ–°çš„æ–¹æ³•å®ä¾‹ä½œä¸ºçš„æ–°çš„å±æ€§ä¼ é€’ï¼Œå¸¦æ¥äº†é¢å¤–çš„æ€§èƒ½å¼€é”€</p>
<h5 id="åœ¨renderä¸­æ˜¾ç¤ºbind"><a href="#åœ¨renderä¸­æ˜¾ç¤ºbind" class="headerlink" title="åœ¨renderä¸­æ˜¾ç¤ºbind"></a>åœ¨<code>render</code>ä¸­æ˜¾ç¤º<code>bind</code></h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bind3 (t, event) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'bind3'</span>, <span class="keyword">this</span>, t, event)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> render () &#123;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     &lt;div&gt;</span><br><span class="line">       <span class="comment">// &lt;button onClick=&#123;this.bind3.bind(this)&#125;&gt;æ‰“å°3&lt;/button&gt; æ— å‚å†™æ³•</span></span><br><span class="line">       &lt;button onClick=&#123;<span class="keyword">this</span>.bind3.bind(<span class="keyword">this</span>, xxx)&#125;&gt;æ‰“å°<span class="number">3</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">     &lt;/</span>div&gt;</span><br><span class="line">   )</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§å†™æ³•è™½ç„¶å’ŒåŒ¿åå‡½æ•°å†™æ³•ä¸Šå®Œå…¨ä¸ä¸€æ ·ï¼Œä½†æ˜¯ç¼ºç‚¹åŸºæœ¬ä¸Šå¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ ·çš„ ğŸ˜‚ï¼Œä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ </p>
<h5 id="ä½¿ç”¨å±æ€§åˆå§‹åŒ–å™¨è¯­æ³•ç»‘å®šthis"><a href="#ä½¿ç”¨å±æ€§åˆå§‹åŒ–å™¨è¯­æ³•ç»‘å®šthis" class="headerlink" title="ä½¿ç”¨å±æ€§åˆå§‹åŒ–å™¨è¯­æ³•ç»‘å®šthis"></a>ä½¿ç”¨å±æ€§åˆå§‹åŒ–å™¨è¯­æ³•ç»‘å®šthis</h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">bind3 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">     xxx: <span class="string">'xxx'</span></span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> render () &#123;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     &lt;div&gt;</span><br><span class="line">       &lt;button onClick=&#123;<span class="keyword">this</span>.bind3&#125;&gt;æ‰“å°<span class="number">3</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">     &lt;/</span>div&gt;</span><br><span class="line">   )</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•åˆ©ç”¨äº†ç®­å¤´å‡½æ•°ä¸­<code>ç®­å¤´å‡½æ•°å†…éƒ¨çš„thisæ˜¯è¯æ³•ä½œç”¨åŸŸï¼Œç”±ä¸Šä¸‹æ–‡ç¡®å®š</code>çš„ç‰¹ç‚¹ï¼Œå†™æ³•ä¸Šæ¯”è¾ƒç®€å•ï¼Œä¸”ä¸ä¼šå¸¦æ¥é¢å¤–æ€§èƒ½å¼€é”€ï¼Œå¹¶ä¸”ä¸ä¼šåƒç¬¬ä¸€ç§é‚£æ ·å¸¦æ¥å¤šä½™ä»£ç ï¼Œçœ‹ä¼¼å¾ˆå®Œç¾ï¼Œä½†æ˜¯å’Œåœ¨<code>constructor</code>ä¸€æ ·ï¼Œæ— æ³•å°†å‚æ•°åŠ¨æ€åŒ–</p>
<h5 id="this-xxx"><a href="#this-xxx" class="headerlink" title="::this.xxx()"></a><code>::this.xxx()</code></h5><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> bind5()&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'bind5'</span>, <span class="keyword">this</span>)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;::<span class="keyword">this</span>.bind5&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">   &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"> )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•æˆ‘è‡ªå·±æ²¡ç”¨è¿‡ï¼Œæ‰€ä»¥ä¸çŸ¥é“å…·ä½“æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</p>
<p>ä¸Šé¢å‡ ç§æ˜¯ç›®å‰æˆ‘ä»¬å†™<code>React</code>ç»„ä»¶æ—¶ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šç”¨åˆ°çš„å‡ ç§<code>this</code>ç»‘å®šæ–¹å¼ï¼Œé€šè¿‡åˆ†ææ¥çœ‹ï¼Œå¤šå¤šå°‘å°‘éƒ½æœ‰ä¸€ç‚¹ç¼ºç‚¹ï¼Œç›®å‰ä¹Ÿæœ‰å¾ˆå¤šå¼€æºæ¯”å¦‚<a href="[https://www.npmjs.com/package/auto-bind](https://www.npmjs.com/package/auto-bind">autobind</a>æˆ–è€…<a href="[https://www.npmjs.com/package/memo-bind](https://www.npmjs.com/package/memo-bind">memo-bind</a>ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰éƒ¨åˆ†ä¸è¶³ï¼Œæ‰€ä»¥å†³å®šè‡ªå·±å®ç°ä¸€ä¸ªï¼š</p>
<h5 id="bind-with-arguments"><a href="#bind-with-arguments" class="headerlink" title="bind-with-arguments"></a>bind-with-arguments</h5><p>å…ˆæ¥çœ‹çœ‹åŸºç¡€ç‰ˆæœ¬çš„:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindWithArguments</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">  	<span class="comment">//	ç¼“å­˜æœ€ç»ˆè¦æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> excuter = target[name];</span><br><span class="line"></span><br><span class="line">		<span class="comment">//	å¯¹è¯¥æ–¹æ³•è¿›è¡Œé‡æ–°åŒ…è£…</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(target, descriptor, &#123;</span><br><span class="line">        value: <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">              	<span class="comment">//	ç”¨applyæ¥ç»‘å®šä½œç”¨åŸŸä»¥åŠä¼ å…¥å¤–éƒ¨å‚æ•°, å¹¶ä¸”æŠŠæ‰§è¡Œç»“æœä½œä¸ºè¿”å›å€¼</span></span><br><span class="line">                <span class="keyword">return</span> excuterType.apply(target, args);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œä¸Šè¿°ç‰ˆæœ¬åªèƒ½æ»¡è¶³åŒæ­¥çš„å›è°ƒå‡½æ•°ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®ç”¨æˆ·æ“ä½œæ¥å‘èµ·æŸä¸ªå…·ä½“çš„å¼‚æ­¥è¯·æ±‚ï¼Œæ‰€ä»¥ä»…ä»…ä¸Šé¢é‚£éƒ¨åˆ†æ˜¯ä¸è¡Œçš„ï¼Œæ ¹æ®<a href="[https://developer.mozilla.org/](https://developer.mozilla.org/">MDN</a>ä¸Šå¯¹<a href="[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncFunction](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncFunction">async</a>çš„ä»‹ç»ï¼Œæˆ‘ä»¬æ¥å®Œå–„ä»£ç :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindWithArguments</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">  	<span class="comment">//	ç¼“å­˜æœ€ç»ˆè¦æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">const</span> excutor = target[name];</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//	æ™®é€šæ–¹æ³•: [object Function] async: [object AsyncFunction]</span></span><br><span class="line">    <span class="keyword">const</span> excutorType = &#123;&#125;.toString.call(excutor).slice(<span class="number">8</span>, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">const</span> isAsync = excutorType === <span class="string">'AsyncFunction'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(target, descriptor, &#123;</span><br><span class="line">        value: <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> isAsync ? <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">              	<span class="comment">//	å¦‚æœæ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œå°±ç”¨async/awaitåŒ…ä¸€å±‚å†è¿”å›å‡ºå»</span></span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">await</span> excutor.apply(target, args));</span><br><span class="line">            &#125; : <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> excutor.apply(target, args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¼‚æ­¥æ–¹æ³•å·²ç»æ”¯æŒäº†ï¼Œçœ‹ä¸‹å…·ä½“ç”¨æ³•</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deffer = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> asyncFn(a, b) &#123;</span><br><span class="line">        <span class="keyword">await</span> deffer();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'deffer'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//	è£…é¥°åŒæ­¥æ–¹æ³•</span></span><br><span class="line">    @bindWithArg</span><br><span class="line">    <span class="keyword">async</span> callAsync() &#123;</span><br><span class="line">        <span class="built_in">console</span>.time();</span><br><span class="line">      	<span class="comment">//	å†…éƒ¨å†è°ƒç”¨å¼‚æ­¥æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="keyword">this</span>.asyncFn(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">console</span>.timeEnd();</span><br><span class="line">        <span class="comment">//  åç»­å·¥ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//	è£…é¥°åŒæ­¥æ–¹æ³•</span></span><br><span class="line">    @bindWithArg</span><br><span class="line">    syncFn(a, b) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h3&gt;bindWithArguments&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">            		/</span><span class="regexp">/	è°ƒç”¨åŒæ­¥æ–¹æ³•</span></span><br><span class="line"><span class="regexp">                &lt;p onClick=&#123;this.syncFn('1', &#123;</span></span><br><span class="line"><span class="regexp">                    a: 'xxx',</span></span><br><span class="line"><span class="regexp">                    b: 'yyy'</span></span><br><span class="line"><span class="regexp">                &#125;)&#125;&gt;sync fn&lt;/</span>p&gt;</span><br><span class="line">            		<span class="comment">//	è°ƒç”¨å¼‚æ­¥æ–¹æ³•</span></span><br><span class="line">                &lt;p onClick=&#123;<span class="keyword">this</span>.callAsync()&#125;&gt; <span class="keyword">async</span> click fn&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä¸Šé¢çš„ä¾‹å­å·²ç»å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯å…¶å®è¿˜æœ‰ä¸€ç‚¹ä¸å¤ªå®Œç¾çš„åœ°æ–¹ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸éœ€è¦ä¼ å…¥ä»»ä½•å‚æ•°çš„æ—¶å€™ä¹Ÿæ˜¯ç”¨<code>onClick={ this.xxx() }</code>æ¥è°ƒç”¨ï¼Œå¯¹äºç”¨æƒ¯äº†<code>autobind</code>çš„æˆ‘ä»¬å¯èƒ½ä¸å¤ªä¹ æƒ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å®Œå–„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> functionMap = &#123;</span><br><span class="line">    <span class="comment">//	å¼‚æ­¥å¹¶ä¸”æœ‰å‚æ•°</span></span><br><span class="line">    AsyncWith: <span class="function">(<span class="params">excutor, target, ...argus</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span>  <span class="keyword">async</span> () =&gt; (<span class="keyword">await</span> excutor.apply(target, argus))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//	å¼‚æ­¥æ— å‚æ•°</span></span><br><span class="line">    AsyncEmpty: <span class="keyword">async</span> (excutor, target) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">await</span> excutor.call(target));</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//	åŒæ­¥å¹¶ä¸”æœ‰å‚æ•°</span></span><br><span class="line">    SyncWith: <span class="function">(<span class="params">excutor, target, ...argus</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> excutor.apply(target, argus);;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//	åŒæ­¥æ— å‚æ•°</span></span><br><span class="line">    SyncEmpty: <span class="function">(<span class="params">excutor, target</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> excutor.call(target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindWithArg</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> excutor = target[name];</span><br><span class="line">    <span class="keyword">const</span> excutorType = &#123;&#125;.toString.call(excutor).slice(<span class="number">8</span>, <span class="number">-1</span>);</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//	åˆ¤æ–­æ˜¯å¦å¼‚æ­¥</span></span><br><span class="line">    <span class="keyword">const</span> asyncCall = excutorType === <span class="string">'AsyncFunction'</span> ? <span class="string">'Async'</span> : <span class="string">'Sync'</span>;</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//	åˆ¤æ–­æ˜¯å¦æœ‰å‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> emptyCall = excutor.length === <span class="number">0</span> ? <span class="string">'Empty'</span> : <span class="string">'With'</span>;</span><br><span class="line">    <span class="keyword">const</span> fnType = <span class="string">`<span class="subst">$&#123;asyncCall&#125;</span><span class="subst">$&#123;emptyCall&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(target, descriptor, &#123;</span><br><span class="line">        value: functionMap[fnType].bind(<span class="literal">null</span>, excutor, target)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œå°±å®Œæˆäº†æ‰€æœ‰åŠŸèƒ½ï¼Œä¸»è¦æ˜¯ç”¨åˆ°é—­åŒ…å’Œå‡½æ•°å½¢å‚çš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œæœ¬é¡¹ç›®å·²ç»å¼€æºåˆ°<a href="https://github.com/rwson/bind-with-arguments.git" target="_blank" rel="noopener">github</a>ï¼Œéœ€è¦äº†è§£è¯¦ç»†çš„è¯·ç§»æ­¥</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤è£…é¥°å™¨ä¸æ”¯æŒ<code>ä½¿ç”¨å±æ€§åˆå§‹åŒ–å™¨è¯­æ³•ç»‘å®šthis</code>çš„å†™æ³•ï¼Œå› ä¸ºè¿™ç§å†™æ³•åœ¨å®šä¹‰è¯¥å‡½æ•°æ—¶ï¼Œå·²ç»åšäº†ç»‘å®šï¼Œæ‰€ä»¥æ— éœ€åšé‡å¤å·¥ä½œ</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/03/26/2020-03-26-read-npx/" class="prev">ä¸Šä¸€ç¯‡</a><a href="/2018/06/06/2018-06-06-read-redux-logic/" class="next">ä¸‹ä¸€ç¯‡</a></div><div class="copyright"><p>Â© 2015 - 2020 <a href="http://yoursite.com">rwson</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>