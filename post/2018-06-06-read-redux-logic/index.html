<!DOCTYPE html>






































<html
  class="not-ready text-sm lg:text-base"
  style="--bg: #faf6f1"
  lang="zh"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>redux-logicæºç é˜…è¯» - rwson</title>

  
  <meta name="theme-color" />

  
  
  
  <meta name="description" content="åœ¨ç”¨Reactå’ŒReduxåšå¼€å‘æ—¶, éƒ½ä¼šç”¨åˆ°å¼‚æ­¥çš„ä¸€äº›ä¸œè¥¿, ä¹‹å‰æ›´å¤šçš„ç”¨çš„æ˜¯redux-thunkæˆ–è€…redux-sagaä¹‹ç±»çš„, ä½†æ˜¯éƒ½æœ‰ç”¨çš„ä¸é¡ºçš„åœ°æ–¹, æœ‰ä¸€æ¬¡çªç„¶å‘ç°redux-logicæ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„è§£å†³æ–¹æ¡ˆ, ç”¨èµ·æ¥ä¹Ÿæ„Ÿè§‰å¾ˆé¡ºæ‰‹, ä¸å¸‚é¢ä¸Šå…¶ä»–reduxä¸­é—´ä»¶ä¸åŒçš„åˆ†æéƒ½åœ¨è¿™é‡Œ, æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±æŸ¥çœ‹ã€‚
é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹redux-logicçš„åŸºæœ¬ç”¨æ³•:
 //	logic/index.js import { createLogic } from &#39;redux-logic&#39;;  const someLogic = createLogic({ 	//	å½“å‰logicç›‘å¬çš„actionType 	type: &#39;SOME_ACTION_TYPE&#39;,  	//	å–æ¶ˆå½“å‰logicæ‰§è¡Œçš„actionType 	cancelType: &#39;CANCEL_TYPE&#39;,  	//	æ˜¯å¦è·å–æœ€åä¸€ä¸ªè¿”å› 	latest: true,  	//	å½“å‰actionTypeçš„ä¸šåŠ¡é€»è¾‘ 	async process({ getState, action, cancelled }, dispatch, done) { 	const res = await asyncFn(); 	dispatch(newAction({ 	...res 	})); 	done(); 	} });  export someLogic;  //	store/index." />
  <meta name="author" content="rwson" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="/main.min.css" />

  
  <script defer src="/highlight.min.js" onload="hljs.initHighlightingOnLoad()"></script>
  

  
   
  <link rel="preload" as="image" href="/theme.png" />

  
  
  
  <link rel="preload" as="image" href="https://avatars.githubusercontent.com/u/9476421" />
  
  

  
  <link rel="preload" as="image" href="/github.svg" />
  
  <link rel="preload" as="image" href="/linkedin.svg" />
  
  <link rel="preload" as="image" href="/rss.svg" />
  
  

  
  

  
  <link rel="icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.96.0" />

  
  

  
  
  
  
  
  
  
  <meta property="og:title" content="redux-logicæºç é˜…è¯»" />
<meta property="og:description" content="redux-logicä½œä¸ºReactä¸­çš„ä¸€ä¸ªå¼‚æ­¥ä¸­é—´ä»¶, ä¸ªäººæ„Ÿè§‰æ¯”thunkæˆ–sagaæ˜“ä¸Šæ‰‹, æ•…ç ”ç©¶ä¸‹å®ç°ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/2018-06-06-read-redux-logic/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2018-06-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-06-06T00:00:00+00:00" />


  
  <meta itemprop="name" content="redux-logicæºç é˜…è¯»">
<meta itemprop="description" content="redux-logicä½œä¸ºReactä¸­çš„ä¸€ä¸ªå¼‚æ­¥ä¸­é—´ä»¶, ä¸ªäººæ„Ÿè§‰æ¯”thunkæˆ–sagaæ˜“ä¸Šæ‰‹, æ•…ç ”ç©¶ä¸‹å®ç°ã€‚"><meta itemprop="datePublished" content="2018-06-06T00:00:00+00:00" />
<meta itemprop="dateModified" content="2018-06-06T00:00:00+00:00" />
<meta itemprop="wordCount" content="2634">
<meta itemprop="keywords" content="" />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="redux-logicæºç é˜…è¯»"/>
<meta name="twitter:description" content="redux-logicä½œä¸ºReactä¸­çš„ä¸€ä¸ªå¼‚æ­¥ä¸­é—´ä»¶, ä¸ªäººæ„Ÿè§‰æ¯”thunkæˆ–sagaæ˜“ä¸Šæ‰‹, æ•…ç ”ç©¶ä¸‹å®ç°ã€‚"/>

  
  
  <script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.10.1/tsparticles.confetti.bundle.min.js"></script>
  <script>const emojConfig={spread:360,ticks:200,gravity:1,decay:.94,startVelocity:30,particleCount:100,scalar:2,shapes:["image"]},randomInRange=(t,e)=>Math.random()*(e-t)+t,fireDefault=()=>confetti({angle:randomInRange(55,125),spread:randomInRange(50,70),particleCount:randomInRange(50,100),origin:{y:.6}}),fireDog=()=>confetti({...emojConfig,shapeOptions:{image:new Array(parseInt(randomInRange(10,20))).fill({src:"https://avatars.githubusercontent.com/u/9476421",width:16,height:16})}}),fireEmoj=()=>confetti({...emojConfig,shapeOptions:{image:[{src:"https://particles.js.org/images/fruits/apple.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/avocado.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/banana.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/berries.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/cherry.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/grapes.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/lemon.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/orange.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/peach.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/pear.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/pepper.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/plum.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/star.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/strawberry.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/watermelon.png",width:32,height:32},{src:"https://particles.js.org/images/fruits/watermelon_slice.png",width:32,height:32}]}}),fireRealistic=()=>{const t={origin:{y:.7}},e=(e,s)=>{confetti(Object.assign({},t,s,{particleCount:Math.floor(200*e)}))};e(.25,{spread:26,startVelocity:55}),e(.2,{spread:60}),e(.35,{spread:100,decay:.91,scalar:.8}),e(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2}),e(.1,{spread:120,startVelocity:45})};window.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",t=>{if("A"===t.target.tagName&&Boolean(e.target.href))return;const s=Math.floor(100*Math.random());return s<=25?fireDefault():s<=50?fireDog():s<=75?fireEmoj():void fireRealistic()})});</script>
</head>
  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="/"
      >rwson</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = `"#faf6f1"`.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/rwson"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./linkedin.svg)"
        href="https://linkedin.com/in/%e4%bb%81%e4%bc%9f-%e5%ae%8b-4049a9117"
        target="_blank"
        rel="me"
      >
        linkedin
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="/index.xml"
        target="_blank"
        rel="alternate"
      >
        rss
      </a>
      
    </nav>
    
  </div>
</header>


    
    
    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pb-24 pt-16 dark:prose-invert"
    >
    <div class="-mt-2 mb-20 flex items-center">
      
      <div
        class="mr-5 shrink-0 rounded-full border-[0.5px] border-black/10 bg-white/50 p-3 shadow-sm dark:bg-white/[15%]"
      >
      <a href="/">
        <img
            class="my-0 aspect-square w-16 rounded-full !bg-black/5 hover:animate-spin dark:!bg-black/80"
            src="https://avatars.githubusercontent.com/u/9476421"
            alt="rwson"
          />
      </a>
      </div>
      
      
      <div>
        <h1 class="mb-2 mt-3 text-[1.6rem] font-bold">rwson</h1>
        <div class="break-words">
          ä¸€ä¸ªå‰ç«¯å¼€å‘
        </div>
      </div>
      
    </div>

      

<article>
  <header class="mb-20">
    <h1 class="!my-0 pb-2.5">redux-logicæºç é˜…è¯»</h1>

    
    <div class="text-sm opacity-60">
      
      <time>Jun 6, 2018</time>
      
      
      
      
    </div>
    
  </header>

  <section><p>åœ¨ç”¨<a href="https://reactjs.org/">React</a>å’Œ<a href="https://redux.js.org/">Redux</a>åšå¼€å‘æ—¶, éƒ½ä¼šç”¨åˆ°å¼‚æ­¥çš„ä¸€äº›ä¸œè¥¿, ä¹‹å‰æ›´å¤šçš„ç”¨çš„æ˜¯<code>redux-thunk</code>æˆ–è€…<code>redux-saga</code>ä¹‹ç±»çš„, ä½†æ˜¯éƒ½æœ‰ç”¨çš„ä¸é¡ºçš„åœ°æ–¹, æœ‰ä¸€æ¬¡çªç„¶å‘ç°<a href="https://github.com/jeffbski/redux-logic">redux-logic</a>æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„è§£å†³æ–¹æ¡ˆ, ç”¨èµ·æ¥ä¹Ÿæ„Ÿè§‰å¾ˆé¡ºæ‰‹, ä¸å¸‚é¢ä¸Šå…¶ä»–<code>redux</code>ä¸­é—´ä»¶ä¸åŒçš„åˆ†æéƒ½åœ¨<a href="https://codewinds.com/assets/article/redux-logic-nodevember.pdf">è¿™é‡Œ</a>, æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±æŸ¥çœ‹ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸‹<code>redux-logic</code>çš„åŸºæœ¬ç”¨æ³•:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//	logic/index.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">createLogic</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;redux-logic&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">someLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createLogic</span>({
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	å½“å‰logicç›‘å¬çš„actionType
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;SOME_ACTION_TYPE&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	å–æ¶ˆå½“å‰logicæ‰§è¡Œçš„actionType
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">cancelType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;CANCEL_TYPE&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	æ˜¯å¦è·å–æœ€åä¸€ä¸ªè¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">latest</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	å½“å‰actionTypeçš„ä¸šåŠ¡é€»è¾‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">async</span> <span style="color:#a6e22e">process</span>({ <span style="color:#a6e22e">getState</span>, <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">cancelled</span> }, <span style="color:#a6e22e">dispatch</span>, <span style="color:#a6e22e">done</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">res</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">asyncFn</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">newAction</span>({
</span></span><span style="display:flex;"><span>			...<span style="color:#a6e22e">res</span>
</span></span><span style="display:flex;"><span>		}));
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">done</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#a6e22e">someLogic</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//	store/index.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">createStore</span>, <span style="color:#a6e22e">applyMiddleware</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;redux&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">createLogicMiddleware</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;redux-logic&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">routerMiddleware</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react-router-redux&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">reducer</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../reducers&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">history</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../history&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">someLogic</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;../logic&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">configureStore</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reduxRouteMiddleware</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">routerMiddleware</span>(<span style="color:#a6e22e">history</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//	å°†æ‰€æœ‰çš„logicåº”ç”¨åˆ°ä¸­é—´ä»¶ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    	<span style="color:#a6e22e">loggicMiddleware</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createLogicMiddleware</span>([<span style="color:#a6e22e">someLogic</span>]),
</span></span><span style="display:flex;"><span>    	<span style="color:#a6e22e">middlewares</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">NODE_ENV</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;development&#39;</span> <span style="color:#f92672">?</span> [<span style="color:#a6e22e">loggicMiddleware</span>, <span style="color:#a6e22e">reduxRouteMiddleware</span>, <span style="color:#a6e22e">logger</span>] <span style="color:#f92672">:</span> [<span style="color:#a6e22e">loggicMiddleware</span>, <span style="color:#a6e22e">reduxRouteMiddleware</span>],
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">createStoreWithMiddleware</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">applyMiddleware</span>(...<span style="color:#a6e22e">middlewares</span>)(<span style="color:#a6e22e">createStore</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">store</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createStoreWithMiddleware</span>(<span style="color:#a6e22e">reducer</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">store</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">configureStore</span>();
</span></span></code></pre></div><p>æœ¬æ–‡ä¼šé€æ­¥åˆ†æ<code>redux-logic</code>çš„ç›¸å…³å®ç°, é¦–å…ˆæŠŠ<a href="https://github.com/jeffbski/redux-logic">redux-logic</a>å…‹éš†åˆ°æœ¬åœ°, æºç éƒ½ä½äº<code>redux-logic/src</code>é‡Œé¢, æ‰€ä»¥æˆ‘ä»¬ä»<code>src/index.js</code>å¼€å§‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">createLogic</span>, { <span style="color:#a6e22e">configureLogic</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./createLogic&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">createLogicMiddleware</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;./createLogicMiddleware&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">configureLogic</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createLogic</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createLogicMiddleware</span>
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">configureLogic</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createLogic</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">createLogicMiddleware</span>
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><p>ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°, ä¸€å…±å¯¼å‡º3ä¸ªå‡½æ•°, <code>configureLogic</code>çš„åŠŸèƒ½å°±æ˜¯å¯¹æ‰€æœ‰çš„<code>logic</code>è¿›è¡Œé…ç½®(è¶…æ—¶è­¦å‘Šæ—¶é—´ç­‰), æˆ‘ä»¬ä¸»è¦çœ‹<code>createLogic</code>å’Œ<code>createLogicMiddleware</code>:</p>
<ul>
<li>createLogic</li>
</ul>
<p><code>createLogic</code>ä½äº<code>src/createLogic</code>é‡Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * åˆ›å»ºä¸€ä¸ªLogicå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object} logicOptions
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {String}     logicOptions.name           å¯é€‰å€¼, ä¸»è¦ç”¨äºLogicä¸­çš„å¼‚å¸¸æç¤º, å¯é€‰å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {String}     logicOptions.type           è§¦å‘å½“å‰Logicçš„redux action type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {String}     logicOptions.cancelType     å–æ¶ˆæ‰§è¡Œå½“å‰Logicçš„redux action type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Boolean}    logicOptions.latest         æ˜¯å¦åªè·å–æœ€åä¸€æ¬¡çš„ç»“æœ,ç±»ä¼¼redux-sagaä¸­çš„takeLatest effect
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Number}     logicOptions.debounce       å‡½æ•°å»æŠ–é…ç½®, å•ä½ä¸ºæ¯«ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Object}     logicOptions.throttle       å‡½æ•°èŠ‚æµé…ç½®, å•ä½ä¸ºæ¯«ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Function}   logicOptions.validate       åœ¨æ‰§è¡Œprocessä¹‹å‰çš„ä¸€ä¸ªé’©å­, å¯ä»¥å¯¹å½“å‰actionæ‰§è¡Œä¸€äº›æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Function}   logicOptions.transform      validateçš„ä¸€ä¸ªåˆ«å, validateå’Œtransformåªéœ€æŒ‡å®šä¸€ä¸ªå³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Function}   logicOptions.process        å½“å‰redux action typeå¯¹åº”çš„å¤„ç†é€»è¾‘(å‘èµ·å¼‚æ­¥è¯·æ±‚, åœ¨å¼‚æ­¥è¯·æ±‚è¿”å›æˆåŠŸä¹‹åè§¦å‘æ–°çš„redux action)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Object}     logicOptions.processOptions processä¸­éœ€è¦çš„ä¸€äº›é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *         @param  {Number}     logicOptions.warnTimeout    è¶…æ—¶è­¦å‘Šæ—¶é—´, é»˜è®¤60ç§’, éœ€è¦åœ¨processä¸­æ‰‹åŠ¨è°ƒç”¨doneæ¥ç»ˆæ­¢è¿™ä¸ªLogic, å¦‚æœæ˜¯ä¸€ä¸ªæŒç»­æ€§çš„Logic, warnTimeoutéœ€è¦è®¾ç½®æˆ0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return {Object}              åˆ›å»ºå‡ºæ¥çš„Logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createLogic</span>(<span style="color:#a6e22e">logicOptions</span> <span style="color:#f92672">=</span> {}) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  æ— æ•ˆé…ç½®é¡¹éªŒè¯, æŠŠæ— æ•ˆçš„é…ç½®é¡¹é”®åæ”¾æ•°ç»„è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">invalidOptions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getInvalidOptions</span>(<span style="color:#a6e22e">logicOptions</span>, <span style="color:#a6e22e">allowedOptions</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">invalidOptions</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`unknown or misspelled option(s): </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">invalidOptions</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  name, type, cancelType, validate, transforméƒ½ä»ä¼ å…¥çš„logicOptionsé‡Œé¢è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//  å¦‚æœå…¶ä»–é…ç½®é¡¹æ²¡æœ‰åœ¨logicOptionsä¸­å£°æ˜, å°±ä»é»˜è®¤é…ç½®ä¸­è·å–æˆ–è€…ç»™ä¸€ä¸ªé»˜è®¤å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cancelType</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">warnTimeout</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">defaultOptions</span>.<span style="color:#a6e22e">warnTimeout</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">latest</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">defaultOptions</span>.<span style="color:#a6e22e">latest</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">debounce</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">defaultOptions</span>.<span style="color:#a6e22e">debounce</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">throttle</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">defaultOptions</span>.<span style="color:#a6e22e">throttle</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">validate</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">transform</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">process</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">emptyProcess</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">processOptions</span> <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    } <span style="color:#f92672">=</span> <span style="color:#a6e22e">logicOptions</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  typeå¿…ä¼ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">type</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;type is required, use \&#39;*\&#39; to match all actions&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  validateå’Œtranformåªèƒ½åŒæ—¶æŒ‡å®šä¸€ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">validate</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">transform</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;logic cannot define both the validate and transform hooks they are aliases&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  warnTimeoutéœ€è¦æ”¾åœ¨processOptionsåŒçº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">processOptions</span>.<span style="color:#a6e22e">warnTimeout</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;warnTimeout is a top level createLogic option, not a processOptions option&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  è·å–processOptionsä¸­çš„æ— æ•ˆé…ç½®é¡¹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">invalidProcessOptions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">getInvalidOptions</span>(<span style="color:#a6e22e">processOptions</span>, <span style="color:#a6e22e">allowedProcessOptions</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">invalidProcessOptions</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`unknown or misspelled processOption(s): </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">invalidProcessOptions</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  å¦‚æœvalidateå’Œtransforméƒ½æ²¡ä¼ å…¥,å°±ç”¨é»˜è®¤çš„, å¦åˆ™å°±ç”¨ä¼ å…¥çš„validate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">validateDefaulted</span> <span style="color:#f92672">=</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">validate</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">transform</span>) <span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">identityValidation</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">validate</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  å¦‚æœåœ¨processOptionsé‡Œé¢æŒ‡å®šäº†dispatchMultiple, warnTimeoutåº”è¯¥æ˜¯0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">NODE_ENV</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;production&#39;</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">processOptions</span>.<span style="color:#a6e22e">dispatchMultiple</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">warnTimeout</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`warning: in logic for type(s): </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">type</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> - dispatchMultiple is always true in next version. For non-ending logic, set warnTimeout to 0`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        æ ¹æ®process.lengthå¯ä»¥è·å–ä¼ å…¥çš„processå¯¹åº”çš„å¤„ç†å‡½æ•°ä¸­çš„å½¢å‚ä¸ªæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        ä»è€Œç¡®å®šprocessOptionä¸­çš„ä¸€äº›é»˜è®¤å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        const fn = function(arg1, agr2) {};
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        console.log(fn.length);  -&gt; 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        const fn = function(arg1, agr2, arg3) {};
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        console.log(fn.length); -&gt; 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    **/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  å¦‚æœæ²¡æœ‰æˆ–åªæœ‰ä¸€ä¸ªå½¢å‚æ²¡æœ‰ä¼ å…¥ä¸”dispatchReturnæ²¡æœ‰åœ¨processOptionsä¼ å…¥, å°±æŠŠå®ƒè®¾ç½®æˆtrue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setIfUndefined</span>(<span style="color:#a6e22e">processOptions</span>, <span style="color:#e6db74">&#39;dispatchReturn&#39;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  ä¸¤ä¸ªå½¢å‚(single-dispatchæ¨¡å¼[å·²åºŸå¼ƒ])
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">NODE_ENV</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;production&#39;</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">!</span><span style="color:#a6e22e">processOptions</span>.<span style="color:#a6e22e">dispatchMultiple</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">warnTimeout</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`warning: in logic for type(s): </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">type</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> - single-dispatch mode is deprecated, call done when finished dispatching. For non-ending logic, set warnTimeout: 0`</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            3ä¸ªå½¢å‚åŠæ›´å¤š, è®¤ä¸ºæ˜¯multi-dispatchæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            processOptions.dispatchMultiple = processOptions === undefined ? true : processOptions.dispatchMultiple
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        **/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">setIfUndefined</span>(<span style="color:#a6e22e">processOptions</span>, <span style="color:#e6db74">&#39;dispatchMultiple&#39;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  è¿”å›å¤„ç†å¥½çš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">typeToStrFns</span>(<span style="color:#a6e22e">name</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">typeToStrFns</span>(<span style="color:#a6e22e">type</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cancelType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">typeToStrFns</span>(<span style="color:#a6e22e">cancelType</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">latest</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">debounce</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">throttle</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">validate</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">validateDefaulted</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">transform</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">process</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">processOptions</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">warnTimeout</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä»ä¸Šé¢çš„åˆ†æä¸­æˆ‘ä»¬å¯ä»¥å¾—å‡º: åœ¨<code>createLogic</code>ä¸­åšçš„ä¸»è¦æ˜¯ä¸€äº›å‚æ•°çš„éªŒè¯å’Œé»˜è®¤å€¼çš„å¤„ç†, ä¸‹é¢æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä»–é‡Œé¢çš„è°ƒç”¨çš„ä¸€äº›çš„å®ç°:</p>
<p>å…ˆæ¥çœ‹ä¸‹<code>getInvalidOptions</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>   <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getInvalidOptions</span>(<span style="color:#a6e22e">options</span>, <span style="color:#a6e22e">validOptions</span>) {
</span></span><span style="display:flex;"><span>	  <span style="color:#66d9ef">return</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">options</span>)
</span></span><span style="display:flex;"><span>	    .<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">k</span> =&gt; <span style="color:#a6e22e">validOptions</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">k</span>) <span style="color:#f92672">===</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/**	æ¯”å¦‚åœ¨createLogicé‡Œçš„ç¬¬ä¸€è¡Œå°±è°ƒç”¨äº†è¯¥æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	export default function createLogic(logicOptions = {}) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  const invalidOptions = getInvalidOptions(logicOptions, allowedOptions);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  //	...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	const allowedOptions = [
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;name&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;type&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;cancelType&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;latest&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;debounce&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;throttle&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;validate&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;transform&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;process&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;processOptions&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	  &#39;warnTimeout&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	**/</span>
</span></span></code></pre></div><p>ä»ä¸Šé¢çš„åˆ†æä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡º, <code>getInvalidOptions</code>ç”¨æ¥è·å–<code>Object</code>é‡Œçš„ä¸åˆæ³•çš„é…ç½®é¡¹, å¹¶æŠŠéæ³•çš„<code>key</code>ä½œä¸ºæ•°ç»„çš„å½¢å¼è¿”å›ã€‚</p>
<p><code>typeToStrFns</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">//	å¦‚æœæ˜¯æ•°ç»„å½¢å¼å°±é’ˆå¯¹æ•°ç»„çš„æ¯ä¸€é¡¹éƒ½è°ƒç”¨typeToStrFns, è¿”å›ä¸€ä¸ªæ–°æ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	å¦‚æœæ˜¯å‡½æ•°å½¢å¼å°±è¿”å›å‡½æ•°ä½“çš„å­—ç¬¦ä¸²å½¢å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	å…¶å®ƒç›´æ¥è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">typeToStrFns</span>(<span style="color:#a6e22e">type</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (Array.<span style="color:#a6e22e">isArray</span>(<span style="color:#a6e22e">type</span>)) { <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">type</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">x</span> =&gt; <span style="color:#a6e22e">typeToStrFns</span>(<span style="color:#a6e22e">x</span>)); }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;function&#39;</span>) <span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span>.<span style="color:#a6e22e">toString</span>() <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>setIfUndefined</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">setIfUndefined</span>(<span style="color:#a6e22e">obj</span>, <span style="color:#a6e22e">propName</span>, <span style="color:#a6e22e">propValue</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">obj</span>[<span style="color:#a6e22e">propName</span>] <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">obj</span>[<span style="color:#a6e22e">propName</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">propValue</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ğŸ˜‚</p>
<ul>
<li>createLogicMiddleware
<code>createLogic</code>åˆ†æå®Œäº†, ä¸‹é¢ä¸€èµ·çœ‹çœ‹<code>createLogicMiddleware</code>, <code>createLogicMiddleware</code>ä½äº<code>src/createLogicMiddleware</code>é‡Œ:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	@param arrLogic  Array.&lt;logic&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	@param deps 	 Object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">**/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createLogicMiddleware</span>(<span style="color:#a6e22e">arrLogic</span> <span style="color:#f92672">=</span> [], <span style="color:#a6e22e">deps</span> <span style="color:#f92672">=</span> {}) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>Array.<span style="color:#a6e22e">isArray</span>(<span style="color:#a6e22e">arrLogic</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;createLogicMiddleware needs to be called with an array of logic items&#39;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	åˆ¤æ–­æ˜¯å¦æœ‰é‡å¤çš„logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">duplicateLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">findDuplicates</span>(<span style="color:#a6e22e">arrLogic</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">duplicateLogic</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`duplicate logic, indexes: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">duplicateLogic</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		å› ä¸ºredux-logicé›†æˆäº†rxjs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		æ‰€ä»¥Subjectå’ŒBehaviorSubjectéƒ½æ˜¯rxjsé‡Œçš„ä¸»ä½“
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		BehaviorSubjectä½œä¸ºSubjectçš„ä¸€ä¸ªå˜ä½“, å’ŒSubjectä¸åŒçš„æ˜¯å®ƒæœ‰ä¸€ä¸ªåˆå§‹å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		https://cn.rx.js.org/manual/overview.html#h15
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	**/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">actionSrc$</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Subject</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	ç”¨æ¥ç›‘è§†æ‰€æœ‰action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">monitor$</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Subject</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lastPending$</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">BehaviorSubject</span>({ <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">OP_INIT</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	å¯¹monitor$ä½¿ç”¨ç´¯åŠ å™¨å‡½æ•°,è¿”å›ç”Ÿæˆçš„ä¸­é—´å€¼,å¯é€‰çš„åˆå§‹å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">monitor$</span>
</span></span><span style="display:flex;"><span>    .<span style="color:#a6e22e">scan</span>((<span style="color:#a6e22e">acc</span>, <span style="color:#a6e22e">x</span>) =&gt; { <span style="color:#75715e">// è¿½åŠ ä¸€ä¸ªpendingçŠ¶æ€çš„è®¡æ•°å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pending</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">acc</span>.<span style="color:#a6e22e">pending</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">op</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;top&#39;</span> <span style="color:#f92672">:</span> 		<span style="color:#75715e">// å½“å‰actionä½äºlogicæ ˆçš„é¡¶çº§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;begin&#39;</span> <span style="color:#f92672">:</span> 		<span style="color:#75715e">// å¼€å§‹è§¦å‘ä¸€ä¸ªaction
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">pending</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			åœ¨createLogicé‡Œçš„processä¸­è°ƒç”¨äº†done, doneçš„å®ç°ç¨å€™åˆ†æ;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		**/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;end&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;bottom&#39;</span><span style="color:#f92672">:</span> 			<span style="color:#75715e">// actionå˜æˆäº†ä¸€ä¸ªè¢«è½¬æ¢åçš„æ–°action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			åœ¨createLogicé‡Œçš„validateä¸­è°ƒç”¨äº†allow, ä¸”è§¦å‘äº†ä¸€ä¸ªæ–°çš„action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			craeteLogic({
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				validate({ getState, action }, allow, reject) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">					allow(action);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			})
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		**/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;nextDisp&#39;</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;filtered&#39;</span> <span style="color:#f92672">:</span> 		<span style="color:#75715e">// 	å½“å‰actionç”±äºæ— æ•ˆè¢«è¿‡æ»¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;dispatchError&#39;</span> <span style="color:#f92672">:</span> <span style="color:#75715e">// 	æ´¾å‘actionçš„æ—¶å€™å¼‚å¸¸(å¥½åƒæš‚æ—¶æ²¡ç”¨åˆ°)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			åœ¨actionæ‹¦æˆªå™¨(validate)é‡Œé¢æ‰§è¡Œreject
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			craeteLogic({
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				validate({ getState, action }, allow, reject) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">					reject(action);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">				}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			})
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		**/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;cancelled&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">pending</span> <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        ...<span style="color:#a6e22e">x</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pending</span>
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    }, { <span style="color:#a6e22e">pending</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span> })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	https://cn.rx.js.org/manual/usage.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    .<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">lastPending$</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">savedStore</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">savedNext</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">actionEnd$</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">logicSub</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">logicCount</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	ç¼“å­˜ä¼ å…¥çš„logicæ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">savedLogicArr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arrLogic</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	è°ƒç”¨å®ŒcreateLogicMiddlewareåè¿”å›çš„reduxä¸­é—´ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mw</span>(<span style="color:#a6e22e">store</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	å¤šæ¬¡è°ƒç”¨äº†createLogicMiddleware, å¹¶ä¸”ä¼ å…¥äº†ä¸åŒçš„store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">savedStore</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">savedStore</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">store</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;cannot assign logicMiddleware instance to multiple stores, create separate instance for each&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	ç¼“å­˜æœ¬æ¬¡è°ƒç”¨ä¼ å…¥çš„store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">savedStore</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">store</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">next</span> =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">savedNext</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">next</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//	ä»applyLogicè¿”å›ä¸­è·å–action$, sub, æŠŠlogicCountèµ‹å€¼ç»™cnt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">action$</span>, <span style="color:#a6e22e">sub</span>, <span style="color:#a6e22e">logicCount</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cnt</span> } <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">applyLogic</span>(<span style="color:#a6e22e">arrLogic</span>, <span style="color:#a6e22e">savedStore</span>, <span style="color:#a6e22e">savedNext</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#a6e22e">logicSub</span>, <span style="color:#a6e22e">actionSrc$</span>, <span style="color:#a6e22e">deps</span>, <span style="color:#a6e22e">logicCount</span>,
</span></span><span style="display:flex;"><span>                       <span style="color:#a6e22e">monitor$</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">actionEnd$</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">action$</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">logicSub</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sub</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">logicCount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cnt</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">action</span> =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;starting off&#39;</span>, <span style="color:#a6e22e">action</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;top&#39;</span> });
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">actionSrc$</span>.<span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">action</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">action</span>;
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//	ç»™mwæŒ‚è½½ä¸€ä¸ªæŒ‡å‘monitor$çš„monitor$å±æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">monitor$</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">monitor$</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * ä¸€ä¸ªè‡ªå®šä¹‰é’©å­å‡½æ•°, ä¸»è¦ç”¨äºæµ‹è¯•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @param  {Function} fn   å¯å†™å…¥ç›¸å…³æµ‹è¯•é€»è¾‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @return {Objetc}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">whenComplete</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">whenComplete</span>(<span style="color:#a6e22e">fn</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">identity</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">lastPending$</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  åªæœ‰å½“x.pending &gt; 0æ˜¯æ‰ç»§ç»­å¾€ä¸‹èµ°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            .<span style="color:#a6e22e">takeWhile</span>(<span style="color:#a6e22e">x</span> =&gt; <span style="color:#a6e22e">x</span>.<span style="color:#a6e22e">pending</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">map</span>(( <span style="color:#75715e">/* x */</span> ) =&gt; <span style="color:#66d9ef">undefined</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">toPromise</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">fn</span>);
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		ç»™å½“å‰reduxä¸­é—´ä»¶åŠ¨æ€æ·»åŠ ä¾èµ–(ç›¸å½“äºcreateLogicMiddlewareç¬¬äºŒä¸ªå‚æ•°çš„æ‹“å±•)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	**/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">addDeps</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addDeps</span>(<span style="color:#a6e22e">additionalDeps</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	æ‰€æ·»åŠ çš„ä¾èµ–å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">additionalDeps</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;object&#39;</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;addDeps should be called with an object&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	éå†æ‰€æ·»åŠ çš„ä¸­é—´ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">additionalDeps</span>).<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">k</span> =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">existing</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">deps</span>[<span style="color:#a6e22e">k</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">additionalDeps</span>[<span style="color:#a6e22e">k</span>];
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//	æ‰€æ·»åŠ çš„ä¸­é—´ä»¶ä¸èƒ½å’Œå½“å‰å·²æœ‰çš„é‡å(å½“å‰å·²ç»æœ‰çš„ä¸èƒ½è¢«è¦†ç›–)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">existing</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span> <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">existing</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">newValue</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`addDeps cannot override an existing dep value: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">k</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">deps</span>[<span style="color:#a6e22e">k</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">newValue</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		ç»™å½“å‰reduxä¸­é—´ä»¶åŠ¨æ€æ·»åŠ æ–°çš„logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		@param arrNewLogic Array.&lt;Logic&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	**/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">addLogic</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">addLogic</span>(<span style="color:#a6e22e">arrNewLogic</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">arrNewLogic</span>.<span style="color:#a6e22e">length</span>) { <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">logicCount</span> }; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	åˆå¹¶åˆ°å½“å‰å·²æœ‰çš„æ•°ç»„é‡Œé¢
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">combinedLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">savedLogicArr</span>.<span style="color:#a6e22e">concat</span>(<span style="color:#a6e22e">arrNewLogic</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">duplicateLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">findDuplicates</span>(<span style="color:#a6e22e">combinedLogic</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	åˆ¤æ–­æ˜¯å¦æœ‰é‡å¤
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">duplicateLogic</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`duplicate logic, indexes: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">duplicateLogic</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">action$</span>, <span style="color:#a6e22e">sub</span>, <span style="color:#a6e22e">logicCount</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cnt</span> } <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">applyLogic</span>(<span style="color:#a6e22e">arrNewLogic</span>, <span style="color:#a6e22e">savedStore</span>, <span style="color:#a6e22e">savedNext</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#a6e22e">logicSub</span>, <span style="color:#a6e22e">actionEnd$</span>, <span style="color:#a6e22e">deps</span>, <span style="color:#a6e22e">logicCount</span>, <span style="color:#a6e22e">monitor$</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">actionEnd$</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">action$</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logicSub</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sub</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logicCount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cnt</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">savedLogicArr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">combinedLogic</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;added logic&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">logicCount</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cnt</span> };
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		ç»™å½“å‰reduxä¸­é—´ä»¶åˆå¹¶æ–°çš„logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		@param arrNewLogic Array.&lt;Logic&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	**/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">mergeNewLogic</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mergeNewLogic</span>(<span style="color:#a6e22e">arrMergeLogic</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// åˆ¤æ–­æ˜¯å¦é‡å
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">duplicateLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">findDuplicates</span>(<span style="color:#a6e22e">arrMergeLogic</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">duplicateLogic</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`duplicate logic, indexes: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">duplicateLogic</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// è¿‡æ»¤æ‰é‡å¤çš„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">arrNewLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arrMergeLogic</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">x</span> =&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">savedLogicArr</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">x</span>) <span style="color:#f92672">===</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">addLogic</span>(<span style="color:#a6e22e">arrNewLogic</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	æ›¿æ¢å½“å‰æ‰€æœ‰çš„logicå˜æˆæ–°çš„logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   **/</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mw</span>.<span style="color:#a6e22e">replaceLogic</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">replaceLogic</span>(<span style="color:#a6e22e">arrRepLogic</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">duplicateLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">findDuplicates</span>(<span style="color:#a6e22e">arrRepLogic</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//	åˆ¤æ–­æ–°çš„logicæ•°ç»„é‡Œæ˜¯å¦æœ‰é‡å¤çš„logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">duplicateLogic</span>.<span style="color:#a6e22e">length</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">`duplicate logic, indexes: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">duplicateLogic</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">action$</span>, <span style="color:#a6e22e">sub</span>, <span style="color:#a6e22e">logicCount</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cnt</span> } <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">applyLogic</span>(<span style="color:#a6e22e">arrRepLogic</span>, <span style="color:#a6e22e">savedStore</span>, <span style="color:#a6e22e">savedNext</span>,
</span></span><span style="display:flex;"><span>                     <span style="color:#a6e22e">logicSub</span>, <span style="color:#a6e22e">actionSrc$</span>, <span style="color:#a6e22e">deps</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">monitor$</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">actionEnd$</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">action$</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logicSub</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sub</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">logicCount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cnt</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">savedLogicArr</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arrRepLogic</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;replaced logic&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">logicCount</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cnt</span> };
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">mw</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä»ä¸Šé¢çš„åˆ†æä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡º, <code>createLogicMiddleware</code>è¿”å›äº†ä¸€ä¸ªä¸­é—´ä»¶, è¯¥ä¸­é—´ä»¶åŸºäº<a href="https://cn.rx.js.org/">Rxjs</a>å®ç°, è¿”å›çš„ä¸­é—´ä»¶ä¸­å¤„ç†ç›¸å…³<code>redux action</code>å¯¹åº”çš„é€»è¾‘ã€‚</p>
<p>åœ¨<code>createLogicMiddleware</code>ä¸­è°ƒç”¨äº†ä¸€äº›å…¶ä»–å‡½æ•°, é€ä¸ªçœ‹ä¸‹è¿™äº›å‡½æ•°çš„å®ç°:</p>
<p><code>findDuplicates</code>, è¯¥æ–¹æ³•å®ŒæˆæŸ¥æ‰¾æ•°ç»„é‡Œé¢é‡å¤çš„<code>Logic</code>, å¹¶è®°å½•é‡å¤çš„ä¸‹æ ‡è¿”å›</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	@param arrLogic  Array.&lt;Logic&gt;   logicæ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">**/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Array.&lt;Logic&gt;}  arrLogic Logicæ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return {Array.&lt;Number&gt;}          é‡å¤çš„Logicä¸‹æ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">findDuplicates</span>(<span style="color:#a6e22e">arrLogic</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">arrLogic</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">acc</span>, <span style="color:#a6e22e">x1</span>, <span style="color:#a6e22e">idx1</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  ä¸æ˜¯åŒä¸€ä¸ªä¸‹æ ‡, ä¸”å€¼ç›¸ç­‰çš„æƒ…å†µä¸‹å°±æŠŠä¸‹æ ‡æ”¾åˆ°accé‡Œé¢
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">arrLogic</span>.<span style="color:#a6e22e">some</span>((<span style="color:#a6e22e">x2</span>, <span style="color:#a6e22e">idx2</span>) =&gt; (<span style="color:#a6e22e">idx1</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">idx2</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">x1</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">x2</span>))) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">acc</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">idx1</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">acc</span>;
</span></span><span style="display:flex;"><span>  }, []);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å†çœ‹çœ‹çœ‹<code>applyLogic</code>çš„å®ç°:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Array.&lt;Logic&gt;}   arrLogic        Logicæ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object}         store            redux store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Function}       next             reduxä¸­é—´ä»¶ä¸­çš„ç¬¬äºŒå±‚å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Rx.Subject}     sub              å½“å‰actionå¯¹åº”çš„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Rx.Subject}     actionIn$        å½“å‰actionå¯¹åº”çš„å¯è®¢é˜…å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object}         deps             createLogicMiddleçš„ç¬¬äºŒä¸ªå‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Number}         startLogicCount  ç”¨äºå‘½å
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Rx.Subject}     monitor$         å…¨å±€å¯è®¢é˜…å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return {Object}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">applyLogic</span>(<span style="color:#a6e22e">arrLogic</span>, <span style="color:#a6e22e">store</span>, <span style="color:#a6e22e">next</span>, <span style="color:#a6e22e">sub</span>, <span style="color:#a6e22e">actionIn$</span>, <span style="color:#a6e22e">deps</span>, <span style="color:#a6e22e">startLogicCount</span>, <span style="color:#a6e22e">monitor$</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">store</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">next</span>) { <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;store is not defined&#39;</span>); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  å¦‚æœå½“å‰Logicå·²ç»æ˜¯ä¸€ä¸ªRx.Subject(å·²ç»è¢«è®¢é˜…è¿‡äº†), å–æ¶ˆè®¢é˜…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">sub</span>) { <span style="color:#a6e22e">sub</span>.<span style="color:#a6e22e">unsubscribe</span>(); }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  å¯¹å½“å‰Logicæ•°ç»„è¿›è¡Œæ“ä½œ(å‘½åç­‰), è¿”å›ä¸€ä¸ªæ–°æ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wrappedLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arrLogic</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">logic</span>, <span style="color:#a6e22e">idx</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  ç»™å½“å‰æœªæŒ‡å®šnameçš„Logicè¿›è¡Œå‘½åå¹¶ä¸”è¿”å›, namingç¨å€™åˆ†æ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">namedLogic</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">naming</span>(<span style="color:#a6e22e">logic</span>, <span style="color:#a6e22e">idx</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">startLogicCount</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  åŒ…è£…å‘½ååçš„Logic, wrapperç¨å€™åˆ†æ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">wrapper</span>(<span style="color:#a6e22e">namedLogic</span>, <span style="color:#a6e22e">store</span>, <span style="color:#a6e22e">deps</span>, <span style="color:#a6e22e">monitor$</span>);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">actionOut$</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">wrappedLogic</span>.<span style="color:#a6e22e">reduce</span>((<span style="color:#a6e22e">acc$</span>, <span style="color:#a6e22e">wep</span>) =&gt; <span style="color:#a6e22e">wep</span>(<span style="color:#a6e22e">acc$</span>), <span style="color:#a6e22e">actionIn$</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  è®¢é˜…æ–°çš„Observableå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newSub</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">actionOut$</span>.<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">action</span> =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;actionEnd$&#39;</span>, <span style="color:#a6e22e">action</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">action</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;result&#39;</span>, <span style="color:#a6e22e">result</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;error in mw dispatch or next call, probably in middlware/reducer/render fn:&#39;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">msg</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">err</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span>) <span style="color:#f92672">?</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">err</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">err</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">msg</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;nextError&#39;</span> });
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  actionå˜æˆäº†ä¸€ä¸ªè¢«è½¬æ¢åçš„æ–°action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">nextAction</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;bottom&#39;</span> });
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">action$</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">actionOut$</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sub</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">newSub</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">logicCount</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">startLogicCount</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">arrLogic</span>.<span style="color:#a6e22e">length</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä»ä¸Šé¢çš„åˆ†æä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡º, <code>applyLogic</code>è¿”å›äº†ä¸€ä¸ªæ–°çš„<a href="https://cn.rx.js.org/class/es6/Observable.js~Observable.html">Rx.Observable</a>, é‡Œé¢è°ƒç”¨äº†<code>naming</code>å’Œ<code>wrapper</code>, ä¸‹é¢æˆ‘ä»¬é€ä¸ªåˆ†æä¸‹ã€‚</p>
<p>å…ˆçœ‹<code>naming</code>çš„å®ç°å§:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * åˆ¤æ–­å½“å‰ä¼ å…¥çš„Logicæœ‰æ²¡æœ‰name, æœ‰å°±ä¸åšä»»ä½•æ“ä½œç›´æ¥è¿”å›, æ²¡æœ‰å°±ç»™å½“å‰Logicæ·»åŠ ä¸€ä¸ªnameå±æ€§åè¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object} logic å½“å‰Logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Number} idx   å½“å‰Logicåœ¨arrLogicä¸­çš„ä¸‹æ ‡åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return {Object}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">naming</span>(<span style="color:#a6e22e">logic</span>, <span style="color:#a6e22e">idx</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">logic</span>.<span style="color:#a6e22e">name</span>) { <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">logic</span>; }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>        ...<span style="color:#a6e22e">logic</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`L(</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">logic</span>.<span style="color:#a6e22e">type</span>.<span style="color:#a6e22e">toString</span>()<span style="color:#e6db74">}</span><span style="color:#e6db74">)-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">idx</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å†çœ‹ä¸‹<code>wrapper</code>çš„, <code>wrapper</code>æ˜¯å†™åœ¨<code>src/logicWrapper</code>é‡Œçš„, <code>wrapper</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>Rx.Observable</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Logicä¸­ç›¸å…³å¤„ç†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object}     options.action   å½“å‰action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object}     options.logic    å½“å‰logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object}     options.store    redux store
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Object}     options.deps     createLogicMiddlewareçš„ç¬¬äºŒä¸ªå‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Rx.Subject} options.cancel$  å–æ¶ˆLogicæ‰§è¡Œçš„è®¢é˜…å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param  {Rx.Subject} options.monitor$ å…¨å±€å¯è®¢é˜…å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return {Rx.Observable}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createLogicAction$</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">logic</span>, <span style="color:#a6e22e">store</span>, <span style="color:#a6e22e">deps</span>, <span style="color:#a6e22e">cancel$</span>, <span style="color:#a6e22e">monitor$</span> }) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  reduxStore.getState()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">getState</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">store</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  ä»å½“å‰logicä¸­å–å¾—ç›¸å…³é…ç½®å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">warnTimeout</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">process</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">processFn</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">processOptions</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">dispatchReturn</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">dispatchMultiple</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">successType</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">failType</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#f92672">=</span> <span style="color:#a6e22e">logic</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  å½“å‰Logicçš„æ‹¦æˆªå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">intercept</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">logic</span>.<span style="color:#a6e22e">validate</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">logic</span>.<span style="color:#a6e22e">transform</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#39;createLogicAction$&#39;</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">action</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  å¼€å§‹æœ¬æ¬¡actionçš„æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;begin&#39;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        1.å½“å‰actionå‘ç”Ÿæ”¹å˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        2.åœ¨validate/transformä¸­è°ƒç”¨allow
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        3.æ— æ•ˆçš„action type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        4.actionè¢«å–æ¶ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        interceptCompleteéƒ½ä¼šå˜æˆtrue, æ ‡è®°æ‹¦æˆªå™¨å¤„ç†å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     **/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">interceptComplete</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//  https://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-take
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">logicAction$</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Observable</span>.<span style="color:#a6e22e">create</span>(<span style="color:#a6e22e">logicActionObs</span> =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  åˆ›å»ºä¸€ä¸ªä¸»é¢˜(åªå‘å‡ºä¸€ä¸ªå€¼), ç”¨æ¥è®¢é˜…`å–æ¶ˆLogicæ‰§è¡Œçš„è®¢é˜…å¯¹è±¡`, åœ¨å–æ¶ˆæœ¬æ¬¡actionå, é€šçŸ¥`å–æ¶ˆLogicæ‰§è¡Œçš„è®¢é˜…å¯¹è±¡`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cancelled$</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Subject</span>()).<span style="color:#a6e22e">take</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">cancel$</span>.<span style="color:#a6e22e">subscribe</span>(<span style="color:#a6e22e">cancelled$</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">cancelled$</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">subscribe</span>(
</span></span><span style="display:flex;"><span>                    () =&gt; {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//  ç¡®ä¿cancelä¸ä¼šè¢«è°ƒç”¨2æ¬¡(åœ¨createLogicMiddleä¸­è¿½åŠ çš„pendingåªä¼šè¢«å‡ä¸€æ¬¡)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">interceptComplete</span>) {
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;cancelled&#39;</span> });
</span></span><span style="display:flex;"><span>                        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dispCancelled&#39;</span> });
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  å¦‚æœå½“å‰Logicä¸æ˜¯ä¸€ä¸ªæŒç»­æ€§çš„, ä¸”æ²¡æœ‰åœ¨warnTimeout / 1000ç§’å†…è°ƒç”¨done(warnTimeout &gt; 0), å°±ç»™å‡ºå¼‚å¸¸æç¤º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">NODE_ENV</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;production&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">warnTimeout</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">Observable</span>.<span style="color:#a6e22e">timer</span>(<span style="color:#a6e22e">warnTimeout</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">//  https://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-takeUntil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#75715e">//  https://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-defaultIfEmpty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    .<span style="color:#a6e22e">takeUntil</span>(<span style="color:#a6e22e">cancelled$</span>.<span style="color:#a6e22e">defaultIfEmpty</span>(<span style="color:#66d9ef">true</span>))
</span></span><span style="display:flex;"><span>                    .<span style="color:#66d9ef">do</span>(() =&gt; {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//	console.error(`warning: logic (${name}) is still running after ${warnTimeout / 1000}s, forget to call done()? For non-ending logic, set warnTimeout: 0`);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    })
</span></span><span style="display:flex;"><span>                    .<span style="color:#a6e22e">subscribe</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">dispatch$</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Subject</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">mergeAll</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">takeUntil</span>(<span style="color:#a6e22e">cancel$</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">dispatch$</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    .do({
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        nextOrObserver: mapToActionAndDispatch,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        error: mapErrorToActionAndDispatch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    })
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    è¿™é‡Œçœç•¥äº†nextOrObserverå’Œerror
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    https://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-do
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                 **/</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#66d9ef">do</span>(
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">mapToActionAndDispatch</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">mapErrorToActionAndDispatch</span>
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">subscribe</span>({
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> ( <span style="color:#75715e">/* err */</span> ) =&gt; {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//  åœ¨å‘ç”Ÿå¼‚å¸¸å, ç»ˆæ­¢æœ¬æ¬¡acion, å¹¶ä¸”å–æ¶ˆè®¢é˜…cancelled$
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;end&#39;</span> });
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">cancelled$</span>.<span style="color:#a6e22e">complete</span>();
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">cancelled$</span>.<span style="color:#a6e22e">unsubscribe</span>();
</span></span><span style="display:flex;"><span>                    },
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">complete</span><span style="color:#f92672">:</span> () =&gt; {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//  æœ¬æ¬¡actionå¤„ç†å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;end&#39;</span> });
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">cancelled$</span>.<span style="color:#a6e22e">complete</span>();
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">cancelled$</span>.<span style="color:#a6e22e">unsubscribe</span>();
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  è§¦å‘reduxé‡Œé¢çš„action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">storeDispatch</span>(<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">dispAction</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dispatch&#39;</span> });
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">store</span>.<span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">act</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * é€‚é…ä¸åŒæƒ…å†µçš„action, ç»„è£…åå¦‚æœæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„redux action, å°±è°ƒç”¨reduxStore.dispatch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object} actionOrValue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mapToActionAndDispatch</span>(<span style="color:#a6e22e">actionOrValue</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    let act;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    if (isInterceptAction(actionOrValue)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        act = unwrapInterceptAction(actionOrValue);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    } else {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        if (successType) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            act = mapToAction(successType, actionOrValue, false);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        } else {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            act = actionOrValue;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    æŠŠä¸‹é¢çš„ä»£ç æ‹†æˆä¸Šé¢çš„æ ·å­, å¤§æ¦‚åšäº†ä¸‹é¢å‡ ä»¶äº‹æƒ…:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªæ‹¦æˆªå™¨, å¦‚æœæ˜¯å°±æŠŠä¹‹å‰åŒ…è£…çš„æ‹¦æˆªå™¨è§£åŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    åˆ¤æ–­processOptions.successTypeæ˜¯å¦å­˜åœ¨, å­˜åœ¨å°±è°ƒç”¨mapToAction, æ‹¼å‡ºä¸€ä¸ªæ–°çš„redux action, è°ƒç”¨reduxSrore.dispatch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                    å¦åˆ™å°±ç›´æ¥ä½¿ç”¨actionOrValue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                **/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">isInterceptAction</span>(<span style="color:#a6e22e">actionOrValue</span>)) <span style="color:#f92672">?</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">unwrapInterceptAction</span>(<span style="color:#a6e22e">actionOrValue</span>) <span style="color:#f92672">:</span> (<span style="color:#a6e22e">successType</span>) <span style="color:#f92672">?</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">mapToAction</span>(<span style="color:#a6e22e">successType</span>, <span style="color:#a6e22e">actionOrValue</span>, <span style="color:#66d9ef">false</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">actionOrValue</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">storeDispatch</span>(<span style="color:#a6e22e">act</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * æ ¹æ®actionOrValueçš„ç±»å‹æ¥ç»„è£…å¯ä»¥è¢«reduxStore.dispatchè°ƒç”¨çš„action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {any} actionOrValue
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @return {Object}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mapErrorToActionAndDispatch</span>(<span style="color:#a6e22e">actionOrValue</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  æ‹¦æˆªå™¨ç±»å‹çš„ç›´æ¥è°ƒç”¨è§¦å‘__interceptAction
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isInterceptAction</span>(<span style="color:#a6e22e">actionOrValue</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">interceptAction</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">unwrapInterceptAction</span>(<span style="color:#a6e22e">actionOrValue</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">storeDispatch</span>(<span style="color:#a6e22e">interceptAction</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  åˆ¤æ–­Logicä¸­çš„processOptionsé‡Œæœ‰æ²¡æœ‰failType
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">failType</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">//  å¦‚æœæœ‰failType, ç»„è£…ä¸€ä¸ªæ–°çš„redux actionå¹¶è§¦å‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mapToAction</span>(<span style="color:#a6e22e">failType</span>, <span style="color:#a6e22e">actionOrValue</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">storeDispatch</span>(<span style="color:#a6e22e">act</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  actionOrValueæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">actionOrValue</span> <span style="color:#66d9ef">instanceof</span> Error) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//  actionOrValueæœ¬èº«åŒ…å«type, ç›´æ¥è°ƒç”¨redux.dispatch(actionOrValue)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#75715e">//  å¦åˆ™åŒ…è£…å‡ºä¸€ä¸ªredux action(typeä¸ºUNHANDLED_LOGIC_ERROR), åœ¨è°ƒç”¨redux.dispatch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        (<span style="color:#a6e22e">actionOrValue</span>.<span style="color:#a6e22e">type</span>) <span style="color:#f92672">?</span> <span style="color:#a6e22e">actionOrValue</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">UNHANDLED_LOGIC_ERROR</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">actionOrValue</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                        };
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">storeDispatch</span>(<span style="color:#a6e22e">act</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  actionOrValueæ˜¯ä¸€ä¸ªplain objectæˆ–ä¸€ä¸ªå‡½æ•°(action creator)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">typeOfValue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">actionOrValue</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">actionOrValue</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">typeOfValue</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;object&#39;</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">typeOfValue</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;function&#39;</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">storeDispatch</span>(<span style="color:#a6e22e">actionOrValue</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  éå¼‚å¸¸/å‡½æ•°/plain objectçš„æƒ…å†µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#a6e22e">storeDispatch</span>({
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">UNHANDLED_LOGIC_ERROR</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">payload</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">actionOrValue</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * ç»„è£…å‡ºä¸€ä¸ªæœ‰æ•ˆçš„redux actionå¹¶è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {String|Function} type       redux action type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object} payload             redux payload
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Error|Unfdeined} err        error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @return {Object}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">mapToAction</span>(<span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">payload</span>, <span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  action typeæœ¬èº«æ˜¯ä¸€ä¸ªaction creator, ç›´æ¥æ‰§è¡Œtype
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;function&#39;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">type</span>(<span style="color:#a6e22e">payload</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  åŒ…è£…å‡ºä¸€ä¸ªæœ‰æ•ˆçš„redux action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">type</span>, <span style="color:#a6e22e">payload</span> };
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span>) { <span style="color:#a6e22e">act</span>.<span style="color:#a6e22e">error</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>; }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">act</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// allowMore is now deprecated in favor of variable process arity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// which sets processOptions.dispatchMultiple = true then
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// expects done() cb to be called to end
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#75715e">// Might still be needed for internal use so keeping it for now
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">DispatchDefaults</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">allowMore</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * è§¦å‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {[type]} act     [description]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {[type]} options [description]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @return {[type]}         [description]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DispatchDefaults</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">allowMore</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">applyDispatchDefaults</span>(<span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  action !== undefined
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        let action;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        if (isObservable(act)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            action = act;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        } else if (isPromise(act)) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            action = Observable.fromPromise(act);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        } else if (act instanceof Error) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            action = Observable.throw(act);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        } else {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            action = Observable.of(act);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        dispatch$.next(action);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        https://cn.rx.js.org/class/es6/MiscJSDoc.js~ObserverDoc.html#instance-method-next
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                     **/</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">dispatch$</span>.<span style="color:#a6e22e">next</span>(
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">isObservable</span>(<span style="color:#a6e22e">act</span>)) <span style="color:#f92672">?</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">isPromise</span>(<span style="color:#a6e22e">act</span>)) <span style="color:#f92672">?</span> <span style="color:#a6e22e">Observable</span>.<span style="color:#a6e22e">fromPromise</span>(<span style="color:#a6e22e">act</span>) <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">act</span> <span style="color:#66d9ef">instanceof</span> Error) <span style="color:#f92672">?</span> <span style="color:#a6e22e">Observable</span>.<span style="color:#66d9ef">throw</span>(<span style="color:#a6e22e">act</span>) <span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">Observable</span>.<span style="color:#66d9ef">of</span>(<span style="color:#a6e22e">act</span>)
</span></span><span style="display:flex;"><span>                    );
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>(<span style="color:#a6e22e">dispatchMultiple</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">allowMore</span>)) {
</span></span><span style="display:flex;"><span>                   <span style="color:#a6e22e">dispatch$</span>.<span style="color:#a6e22e">complete</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">act</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">applyDispatchDefaults</span>(<span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                    ...<span style="color:#a6e22e">DispatchDefaults</span>,
</span></span><span style="display:flex;"><span>                    ...<span style="color:#a6e22e">options</span>
</span></span><span style="display:flex;"><span>                };
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  æ‹¼è£…createLogicä¸­ç›¸å…³é’©å­å‡½æ•°(validate/tranform/process)ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">depObj</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                ...<span style="color:#a6e22e">deps</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">cancelled$</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">ctx</span><span style="color:#f92672">:</span> {}, <span style="color:#75715e">// åœ¨ä¸åŒé’©å­ä¸­å…±äº«æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#a6e22e">getState</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">action</span>
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">shouldDispatch</span>(<span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">useDispatch</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  æ–°çš„actionä¸ºç©º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">act</span>) { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>; }
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  åœ¨è§¦å‘å¦å¤–ä¸€ä¸ªactionä¹‹å‰, ç¡®ä¿è§¦å‘çš„æ˜¯ä¸€ä¸ªæ–°çš„action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">useDispatch</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;auto&#39;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">act</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">action</span>.<span style="color:#a6e22e">type</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  å¦åˆ™æ ¹æ®useDispatchæ˜¯å¦ä¸ºç©º, è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">return</span> (<span style="color:#a6e22e">useDispatch</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">AllowRejectNextDefaults</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">useDispatch</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;auto&#39;</span>
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">applyAllowRejectNextDefaults</span>(<span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                    ...<span style="color:#a6e22e">AllowRejectNextDefaults</span>,
</span></span><span style="display:flex;"><span>                    ...<span style="color:#a6e22e">options</span>
</span></span><span style="display:flex;"><span>                };
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  æ‹¦æˆªå™¨(validate/tranform)é‡Œçš„allowæˆ–next
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">allow</span>(<span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AllowRejectNextDefaults</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">handleNextOrDispatch</span>(<span style="color:#66d9ef">true</span>, <span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">reject</span>(<span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">options</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AllowRejectNextDefaults</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">handleNextOrDispatch</span>(<span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  å®Œæˆæœ¬æ¬¡action, åœ¨createLogicä¸­çš„processæœ€åè°ƒç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">done</span>() {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">dispatch$</span>.<span style="color:#a6e22e">complete</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * å¯¹å½“å‰æ‹¦æˆªå™¨ç±»å‹action(validate/transform)åšä¸€æ¬¡åŒ…è£…, æ–¹ä¾¿åé¢åˆ¤æ–­
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object} act å½“å‰action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @return {Object}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">wrapActionForIntercept</span>(<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">act</span>) { <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">act</span>; }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">__interceptAction</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">act</span>
</span></span><span style="display:flex;"><span>                };
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * åˆ¤æ–­ä¼ å…¥çš„actionæ˜¯å¦ä¸ºæ‹¦æˆªå™¨ç±»å‹çš„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object}  act å½“å‰action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @return {Boolean}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">isInterceptAction</span>(<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">act</span>.<span style="color:#a6e22e">__interceptAction</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * å¯¹æ‹¦æˆªå™¨æ‰§è¡Œè§£åŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object}  act å½“å‰action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @return {Object}      redux action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">unwrapInterceptAction</span>(<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">act</span>.<span style="color:#a6e22e">__interceptAction</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * æ‹¦æˆªå™¨(validate/tranform)é‡Œçš„allowã€rejectå®ç°, è§¦å‘æ–°çš„redux action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Boolean} shouldProcess æ˜¯å¦æ‰§è¡Œprocess
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object} act            æ–°çš„redux action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object} options
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">handleNextOrDispatch</span>(<span style="color:#a6e22e">shouldProcess</span>, <span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">useDispatch</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">applyAllowRejectNextDefaults</span>(<span style="color:#a6e22e">options</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  åˆ¤æ–­æ˜¯å¦åº”è¯¥è§¦å‘ä¼ å…¥çš„redux action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">shouldDispatch</span>(<span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">useDispatch</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">dispAction</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">shouldProcess</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;nextDisp&#39;</span> });
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">interceptComplete</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">wrapActionForIntercept</span>(<span style="color:#a6e22e">act</span>), { <span style="color:#a6e22e">allowMore</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> }); <span style="color:#75715e">// will be completed later
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#a6e22e">logicActionObs</span>.<span style="color:#a6e22e">complete</span>(); <span style="color:#75715e">// dispatched action, so no next(act)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">// normal next
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">nextAction</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">shouldProcess</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;next&#39;</span> });
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//  æ— æ•ˆçš„action, ç›´æ¥ç»“æŸæœ¬æ¬¡æ‹¦æˆªå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#a6e22e">monitor$</span>.<span style="color:#a6e22e">next</span>({ <span style="color:#a6e22e">action</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">shouldProcess</span>, <span style="color:#a6e22e">op</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;filtered&#39;</span> });
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">interceptComplete</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">postIfDefinedOrComplete</span>(<span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">logicActionObs</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  æ‰§è¡ŒLogicä¸­çš„processå›è°ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">shouldProcess</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">//  ç»„ç»‡depObjçš„actionå‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#a6e22e">depObj</span>.<span style="color:#a6e22e">action</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">act</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">action</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">retValue</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">processFn</span>(<span style="color:#a6e22e">depObj</span>, <span style="color:#a6e22e">dispatch</span>, <span style="color:#a6e22e">done</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            å¦‚æœåœ¨createLogicæŒ‡å®šäº†processOption.dispatchReturnä¸ºtrue, å¹¶ä¸”prcessæ‰§è¡Œå®Œä¹‹åè¿”å›æœ‰æ•ˆçš„å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            å°±å†æŠŠè¿”å›å€¼ä½œä¸ºä¸€ä¸ªæ–°çš„redux actionè¿›è¡Œè§¦å‘
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            å¦åˆ™ç›´æ¥ç»“æŸdispatch$è¿™ä¸ªRx.Subject
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            æ‰§è¡Œprocess, å¹¶ä¸”æ¥æ”¶è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                            åˆ¤æ–­processOption.dispatchReturn
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                æˆç«‹: åˆ¤æ–­è¿”å›å€¼æ˜¯å¦æœ‰æ•ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                    æœ‰æ•ˆ: dispatch -&gt; mapToActionAndDispatch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                        mapToActionAndDispatchè¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„action:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                            ç»§ç»­reduxStore.dispatch(mapToActionAndDispatch(retValue))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                                    æ— æ•ˆ: dispatch$.complete -&gt; monitor$.next({ action, name, op: &#39;end&#39; }); cancelled$.complete(); cancelled$.unsubscribe();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">                        **/</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">dispatchReturn</span>) {
</span></span><span style="display:flex;"><span>                            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">typeof</span> <span style="color:#a6e22e">retValue</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;undefined&#39;</span>) {
</span></span><span style="display:flex;"><span>                                <span style="color:#a6e22e">dispatch$</span>.<span style="color:#a6e22e">complete</span>();
</span></span><span style="display:flex;"><span>                            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">retValue</span>);
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`unhandled exception in logic named: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">//  æ‰§è¡Œprocessçš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#a6e22e">dispatch</span>(<span style="color:#a6e22e">Observable</span>.<span style="color:#66d9ef">throw</span>(<span style="color:#a6e22e">err</span>));
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">//  ä¼ å…¥çš„actæ˜¯ä¸€ä¸ªç©ºå€¼, æˆ–è€…å’Œå½“å‰çš„typeç›¸åŒ, æˆ–è€…useDispatchä¸æˆç«‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    <span style="color:#a6e22e">dispatch$</span>.<span style="color:#a6e22e">complete</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * åœ¨æœ¬æ¬¡æ‹¦æˆªå™¨ä¹‹åæ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Object} act       æ–°çš„action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             * @param  {Rx.Subject} act$  å½“å‰actionå¯¹åº”çš„Observableå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">             */</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">postIfDefinedOrComplete</span>(<span style="color:#a6e22e">act</span>, <span style="color:#a6e22e">act$</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//  å¦‚æœæ–°çš„actionå­˜åœ¨, æ‰§è¡Œæ–°çš„action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">act</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">act$</span>.<span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">act</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">interceptComplete</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">act$</span>.<span style="color:#a6e22e">complete</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//  å¼€å§‹æœ¬æ¬¡actionçš„æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">start</span>() {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">intercept</span>(<span style="color:#a6e22e">depObj</span>, <span style="color:#a6e22e">allow</span>, <span style="color:#a6e22e">reject</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">takeUntil</span>(<span style="color:#a6e22e">cancel$</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//  è§„å®šlogicAction$å€¼å‘å‡ºä¸€ä¸ªå€¼å°±å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        .<span style="color:#a6e22e">take</span>(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">logicAction$</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section>

  
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a
      class="flex w-1/2 items-center rounded-l-md p-6 pr-3 no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="/post/2019-09-28-react-binding-events-with-arguments/"
      ><span class="mr-1.5">â†</span><span>Reactäº‹ä»¶ç»‘å®šç»ˆæä¼˜åŒ–æ–¹æ¡ˆ</span></a
    >
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="/post/2017-11-09-vue-computed-watch/"
      ><span>Vueä¸­computedè®¡ç®—å±æ€§å’Œwatchè§‚å¯Ÿè€…åŸç†</span><span class="ml-1.5">â†’</span></a
    >
    
  </nav>
  

  
  

  
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2015-2023
    <a class="link" href="/">rwson; all rights reserved.</a>
  </div>
</footer>

  </body>
</html>
